/*
 ============================================================================
 Name        : Model_Predictive_Control.c
 Author      : Daniel MÃ¥rtensson
 Version     : 1.0
 Copyright   : MIT
 Description : Model Predictive Control
 ============================================================================
 */

#include <stdio.h>
#include <stdlib.h>

#include "CControl/Headers/Configurations.h"
#include "CControl/Headers/Functions.h"

int main() {

	/*
	 * In this example we have selected the following configuration inside Confiugration.h
	 * SELECTED_CONTROL_STRATEGY MANUAL
	 * ADIM 2
	 * YDIM 1
	 * RDIM 1
	 * HORIZON 100
	 * ALPHA 0.1
     * ITERATION_LIMIT 100
	 */


	/*
	 * State space model
	 */
	float A[ADIM * ADIM] = {0.89559,   0.37735,
		      	  	       -0.37735,   0.51825};
	float B[ADIM * RDIM] = {0.20881,
		       	   	   	    0.75469};
	float C[YDIM * ADIM] = {1,   0};


	/*
	 * Print our state space matrix
	 */
	printf("System matrix: A\n");
	print(A, ADIM, ADIM);

	printf("Input matrix: B\n");
	print(B, ADIM, RDIM);

	printf("Output matrix: C\n");
	print(C, YDIM, ADIM);

	float x[ADIM] = {0, 0};
	float u[RDIM] = { 0 };
	float r[YDIM] = { 12.5 };

	// Do Model Predictive Control where u cannot be negative and output cannot be over r
	mpc(A, B, C, x, u, r);

	// Print solution
	printf("Best input\n");
	print(u, RDIM, 1);


	return EXIT_SUCCESS;
}
